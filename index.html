<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Add & Pop! Homework</title>

<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden; /* NO SCROLL */
    height: 100%;
  }
  body {
    font-family: "Comic Neue", sans-serif;
    background: linear-gradient(135deg, #fdeff9, #ecf0ff);
    text-align: center;
    color: #333;
    display: flex;
    flex-direction: column;
  }

  h1 {
    font-size: 36px;
    margin: 8px 0;
  }

  .card {
    background: white;
    border-radius: 18px;
    padding: 18px;
    margin: auto;
    box-shadow: 0 6px 14px rgba(0,0,0,0.12);
    max-width: 380px;
  }

  .fruits {
    font-size: 50px;
    display: inline-block;
    animation: drop 0.5s ease-out;
  }
  @keyframes drop {
    from { transform: translateY(-40px); opacity: 0; }
    to   { transform: translateY(0); opacity: 1; }
  }

  .correct-anim { animation: bounce 0.6s ease; }
  @keyframes bounce {
    0% { transform: scale(1); }
    30% { transform: scale(1.3); }
    100% { transform: scale(1); }
  }

  .wrong-anim { animation: shake 0.4s ease; }
  @keyframes shake {
    0% { transform: translateX(0); }
    25% { transform: translateX(-6px); }
    50% { transform: translateX(6px); }
    75% { transform: translateX(-6px); }
    100% { transform: translateX(0); }
  }

  button {
    font-size: 24px;
    padding: 12px 22px;
    border-radius: 14px;
    border: none;
    margin: 10px; /* ADDED GAP */
    color: white;
  }
  .whatsapp-btn { background: #25D366; }
  .replay-btn { background: #ffb300; }

  .progress {
    font-size: 22px;
    margin-bottom: 6px;
  }

  #result {
    font-size: 36px;
    margin-top: 10px;
    min-height: 36px;
  }

  .leader {
    font-size: 22px;
    margin: 6px;
  }

  footer {
    font-size: 16px;
    color: #555;
    margin-top: 6px;
    padding-bottom: 6px;
  }
</style>
</head>

<body>

<h1>üçé Add & Pop üçå</h1>

<div id="nameScreen" class="card">
  <input id="nameInput" placeholder="Type your name" style="font-size:24px;" />
  <br><br>
  <button onclick="startGame()">‚ñ∂ Start</button>
</div>

<div id="gameScreen" class="card" style="display:none;">
  <div class="progress"><span id="qno"></span> / 15</div>
  <div id="question"></div>
  <div id="options"></div>
  <div id="result"></div>
</div>

<div id="endScreen" class="card" style="display:none;">
  <div style="font-size:60px;">üë©‚Äçüè´</div>
  <h2 id="endCelebration">üéâ</h2>
  <p id="finalScore" style="font-size:26px;"></p>

  <h3>üèÜ</h3>
  <div id="leaderboard"></div>

  <button onclick="shareResult()" class="whatsapp-btn">üü¢ WhatsApp</button>
  <button onclick="location.reload()" class="replay-btn">üîÑ Replay</button>
</div>

<footer>An MPPS Pedduru Initiative</footer>

<script>
  let name="",score=0,streak=0,questionCount=0,correct;
  const TOTAL=15;
  let answered=false;
  const fruits=["üçé","üçå","üçá","üçì"];

  const ctx = new (window.AudioContext||window.webkitAudioContext)();
  function sound(f,d){
    const o=ctx.createOscillator();
    const g=ctx.createGain();
    o.frequency.value=f;
    o.connect(g);g.connect(ctx.destination);
    o.start();
    g.gain.exponentialRampToValueAtTime(0.0001,ctx.currentTime+d);
    o.stop(ctx.currentTime+d);
  }

  function startGame(){
    name=document.getElementById("nameInput").value||"Friend";
    document.getElementById("nameScreen").style.display="none";
    document.getElementById("gameScreen").style.display="block";
    nextQ();
  }

  function nextQ(){
    answered=false;
    if(questionCount===TOTAL){ endGame(); return; }
    questionCount++;
    document.getElementById("qno").innerHTML=questionCount;
    document.getElementById("result").innerHTML="";

    const a=Math.floor(Math.random()*5)+1;
    const b=Math.floor(Math.random()*5)+1;
    correct=a+b;

    const f1=fruits[Math.floor(Math.random()*fruits.length)];
    const f2=fruits[Math.floor(Math.random()*fruits.length)];

    document.getElementById("question").innerHTML =
      `<div class="fruits">${f1.repeat(a)}</div><br>
       <div style="font-size:38px;">+</div><br>
       <div class="fruits">${f2.repeat(b)}</div>`;

    const ops=[correct,correct+1,correct-1].filter(n=>n>0).sort(()=>Math.random()-0.5);
    const optDiv=document.getElementById("options");
    optDiv.innerHTML="";
    ops.forEach(v=>{
      const btn=document.createElement("button");
      btn.textContent=v;
      btn.onclick=()=>check(v);
      optDiv.appendChild(btn);
    });
  }

  function check(v){
    if(answered)return;
    answered=true;
    document.querySelectorAll("#options button").forEach(b=>b.disabled=true);

    if(v===correct){
      score++; streak++;
      const praise=["Good job!","Super!","Nice!","Great!"];
      document.getElementById("result").textContent=praise[Math.floor(Math.random()*praise.length)];
      document.getElementById("question").classList.add("correct-anim");
      sound(800,0.3);
    } else {
      streak=0;
      document.getElementById("result").textContent="Try next time!";
      document.getElementById("question").classList.add("wrong-anim");
      sound(200,0.3);
    }

    setTimeout(()=>{
      document.getElementById("question").classList.remove("correct-anim","wrong-anim");
      nextQ();
    },1200);
  }

  function endGame(){
    document.getElementById("gameScreen").style.display="none";
    document.getElementById("endScreen").style.display="block";
    document.getElementById("endCelebration").textContent = score===15 ? "Perfect!" : "Good!";
    document.getElementById("finalScore").textContent=`Congratulations! Hey ${name}, you scored ${score}/15`;
  }

  function shareResult(){
    const t=document.getElementById("endScreen");
    html2canvas(t).then(c=>{
      c.toBlob(b=>{
        const f=new File([b],"homework.png",{type:"image/png"});
        if(navigator.canShare && navigator.canShare({files:[f]})){
          navigator.share({files:[f]});
        }
      });
    });
  }
</script>
</body>
</html>
