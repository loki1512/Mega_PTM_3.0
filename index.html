<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add & Pop! Homework</title>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    body {
      font-family: "Comic Sans MS", cursive;
      background: linear-gradient(135deg, #fdeff9, #ecf0ff);
      text-align: center;
      padding: 12px;
      color: #333;
    }

    h1 {
      font-size: 34px;
      margin-bottom: 6px;
    }

    .card {
      background: white;
      border-radius: 18px;
      padding: 16px;
      margin: 12px auto;
      box-shadow: 0 6px 14px rgba(0,0,0,0.12);
      max-width: 380px;
    }

    .fruits {
      font-size: 48px;
      display: inline-block;
      animation: drop 0.5s ease-out;
    }

    @keyframes drop {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .correct-anim {
      animation: bounce 0.6s ease;
    }

    @keyframes bounce {
      0% { transform: scale(1); }
      30% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    .wrong-anim {
      animation: shake 0.4s ease;
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-6px); }
      50% { transform: translateX(6px); }
      75% { transform: translateX(-6px); }
      100% { transform: translateX(0); }
    }

    button {
      font-size: 24px;
      padding: 12px 20px;
      margin: 6px;
      border-radius: 14px;
      border: none;
      background: #6c8cff;
      color: white;
    }

    button:disabled {
      background: #ccc;
    }

    .whatsapp-btn {
      background: #25D366;
      font-size: 26px;
    }

    .replay-btn {
      background: #ffb300;
    }

    input {
      font-size: 22px;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid #ddd;
      text-align: center;
      width: 85%;
    }

    #result {
      font-size: 40px;
      margin-top: 12px;
      min-height: 40px;
    }

    .progress {
      font-size: 20px;
      color: #555;
      margin-bottom: 10px;
    }

    .leader {
      font-size: 22px;
      margin: 6px;
    }

    /* Confetti */
    .confetti {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      animation: confetti-fall 1s ease-out forwards;
      font-size: 38px;
    }

    @keyframes confetti-fall {
      from { transform: translateY(-100px); opacity: 1; }
      to { transform: translateY(300px); opacity: 0; }
    }

    .teacher {
      font-size: 60px;
      animation: bounce 1s infinite alternate;
      margin-bottom: 10px;
    }
  </style>
</head>

<body>

<h1>üçé Add & Pop üçå</h1>

<!-- NAME SCREEN -->
<div id="nameScreen" class="card">
  <p>üëã</p>
  <input id="nameInput" placeholder="Name" />
  <br><br>
  <button onclick="startGame()">‚ñ∂</button>
</div>

<!-- GAME SCREEN -->
<div id="gameScreen" class="card" style="display:none;">
  <div class="progress"><span id="qno"></span> / 15</div>

  <div id="question"></div>
  <div id="options"></div>
  <div id="result"></div>
</div>

<!-- END SCREEN -->
<div id="endScreen" class="card" style="display:none;">
  <div class="teacher">üë©‚Äçüè´</div>
  <h2 id="endCelebration">üéâ</h2>
  <p id="finalScore"></p>

  <h3>üèÜ</h3>
  <div id="leaderboard"></div>

  <br>
  <button onclick="shareResult()" class="whatsapp-btn">üü¢ WhatsApp</button>
  <button onclick="location.reload()" class="replay-btn">üîÑ Replay</button>
</div>

<script>
  let name = "";
  let score = 0;
  let streak = 0;
  let questionCount = 0;
  let correct;
  const TOTAL = 15;
  let answered = false;
  const fruits = ["üçé","üçå","üçá","üçì"];

  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  function sound(f,d){
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.frequency.value = f;
    o.connect(g); g.connect(ctx.destination);
    o.start();
    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + d);
    o.stop(ctx.currentTime + d);
  }

  function confettiBurst(symbol){
    const c = document.createElement("div");
    c.className = "confetti";
    c.textContent = symbol;
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),900);
  }

  function startGame(){
    name = document.getElementById("nameInput").value || "Friend";
    document.getElementById("nameScreen").style.display="none";
    document.getElementById("gameScreen").style.display="block";
    sound(600,0.2);
    nextQ();
  }

  function nextQ(){
    answered = false;

    if(questionCount === TOTAL){
      endGame();
      return;
    }

    questionCount++;
    document.getElementById("qno").innerHTML = questionCount;
    document.getElementById("result").innerHTML = "";

    const a = Math.floor(Math.random()*5)+1;
    const b = Math.floor(Math.random()*5)+1;
    correct = a + b;

    const f1 = fruits[Math.floor(Math.random()*fruits.length)];
    const f2 = fruits[Math.floor(Math.random()*fruits.length)];

    let html="";
    html += `<div class="fruits">${f1.repeat(a)}</div><br>`;
    html += `<div style="font-size:36px;">+</div><br>`;
    html += `<div class="fruits">${f2.repeat(b)}</div>`;

    document.getElementById("question").innerHTML = html;

    const ops=[correct, correct+1, correct-1].filter(n=>n>0).sort(()=>Math.random()-0.5);
    const optDiv = document.getElementById("options");
    optDiv.innerHTML="";

    ops.forEach(v=>{
      const btn = document.createElement("button");
      btn.innerText=v;
      btn.onclick=()=>check(v);
      optDiv.appendChild(btn);
    });
  }

  function check(v){
    if(answered) return;
    answered = true;

    document.querySelectorAll("#options button").forEach(b=>b.disabled=true);

    if(v===correct){
      score++;
      streak++;
      document.getElementById("result").innerHTML="‚ú®";
      document.getElementById("question").classList.add("correct-anim");
      sound(800,0.3);

      if(streak===5) confettiBurst("‚≠ê");
      if(streak===10) confettiBurst("üåü");
    }
    else {
      streak=0;
      document.getElementById("result").innerHTML="‚ùå";
      document.getElementById("question").classList.add("wrong-anim");
      sound(200,0.3);
      confettiBurst("üí¶");
    }

    setTimeout(()=>{
      document.getElementById("question").classList.remove("correct-anim","wrong-anim");
      nextQ();
    },1200);
  }

  function endGame(){
    document.getElementById("gameScreen").style.display="none";
    document.getElementById("endScreen").style.display="block";

    if(score===15){
      confettiBurst("üéâ");
      document.getElementById("endCelebration").innerHTML="üéâ";
    } else {
      document.getElementById("endCelebration").innerHTML="üëè";
    }

    document.getElementById("finalScore").innerHTML = `${score} / 15`;

    saveBoard();
    showBoard();
  }

  function saveBoard(){
    let board = JSON.parse(localStorage.getItem("board"))||[];
    board.push({name,score});
    board.sort((a,b)=>b.score-a.score);
    board = board.slice(0,5);
    localStorage.setItem("board",JSON.stringify(board));
  }

  function showBoard(){
    let board = JSON.parse(localStorage.getItem("board"))||[];
    let h="";
    board.forEach((e,i)=>{
      h+=`<div class="leader">${i+1}. ${e.name} ‚Äî ${e.score}</div>`;
    });
    document.getElementById("leaderboard").innerHTML=h;
  }

  function shareResult(){
    const t=document.getElementById("endScreen");
    html2canvas(t).then(c=>{
      c.toBlob(b=>{
        const f=new File([b],"homework.png",{type:"image/png"});
        if(navigator.canShare && navigator.canShare({files:[f]})){
          navigator.share({files:[f]});
        }
      });
    });
  }
</script>

</body>
</html>