<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Add & Pop! Homework</title>

<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
  body {
    margin: 0;
    font-family: "Comic Neue", sans-serif;
    background: linear-gradient(180deg, #fdeff9, #ecf0ff);
    text-align: center;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  h1 {
    font-size: 40px;
    margin-top: 12px;
  }

  .card {
    background: #ffffff;
    border-radius: 20px;
    padding: 20px;
    margin: 16px auto;
    box-shadow: 0 4px 14px rgba(0,0,0,0.15);
    max-width: 380px;
    width: 90%;
  }

  input {
    font-size: 24px;
    padding: 12px;
    border: 2px solid #aaa;
    border-radius: 12px;
    width: 85%;
    margin-bottom: 12px;
  }

  button {
    font-size: 26px;
    padding: 14px 22px;
    border-radius: 14px;
    border: none;
    color: white;
    cursor: pointer;
    width: 80%;
    margin-top: 10px;
  }

  .start-btn {
    background: #00C853; /* brighter green */
    box-shadow: 0 4px 10px rgba(0, 200, 83, 0.3);
  }

  .whatsapp-btn {
    background: #25D366;
    box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
  }

  .replay-btn {
    background: #FFB300;
    box-shadow: 0 4px 10px rgba(255, 179, 0, 0.3);
  }

  .whatsapp-icon {
    font-size: 30px;
  }

  .fruits {
    font-size: 54px;
    animation: drop 0.45s ease-out;
  }

  @keyframes drop {
    0% { transform: translateY(-40px); opacity: 0; }
    100% { transform: translateY(0); opacity: 1; }
  }

  .correct-anim { animation: bounce 0.5s; }
  @keyframes bounce {
    0% { transform: scale(1); }
    50% { transform: scale(1.25); }
    100% { transform: scale(1); }
  }

  .wrong-anim { animation: shake 0.4s; }
  @keyframes shake {
    0% { transform: translateX(0); }
    25% { transform: translateX(-6px); }
    50% { transform: translateX(6px); }
    75% { transform: translateX(-6px); }
    100% { transform: translateX(0); }
  }

  .progress {
    font-size: 24px;
    margin-bottom: 8px;
  }

  #result {
    font-size: 40px;
    min-height: 42px;
    margin: 10px;
    font-weight: 700;
  }

  footer {
    margin-top: auto;
    padding: 12px;
    font-size: 16px;
    color: #555;
  }
</style>
</head>

<body>

<h1>üçé Add & Pop üçå</h1>

<!-- NAME SCREEN -->
<div id="nameScreen" class="card">
  <input id="nameInput" placeholder="Type your name">
  <button onclick="startGame()" class="start-btn">Start</button>
</div>

<!-- GAME SCREEN -->
<div id="gameScreen" class="card" style="display:none;">
  <div class="progress"><span id="qno"></span> / 15</div>
  <div id="question"></div>
  <div id="options"></div>
  <div id="result"></div>
</div>

<!-- END SCREEN -->
<div id="endScreen" class="card" style="display:none;">
  <div style="font-size:70px;">üë©‚Äçüè´</div>
  <h2 id="endCelebration" style="font-size:32px;"></h2>
  <p id="finalScore" style="font-size:26px;"></p>

  <h3>üèÜ</h3>
  <div id="leaderboard"></div>

  <button onclick="shareResult()" class="whatsapp-btn">
    <span class="whatsapp-icon">üü©</span> Share
  </button>

  <button onclick="location.reload()" class="replay-btn">Replay</button>
</div>

<footer>An MPPS Pedduru Initiative</footer>

<script>
  let name="",score=0,streak=0,questionCount=0,correct;
  const TOTAL=15;
  let answered=false;
  const fruits=["üçé","üçå","üçá","üçì"];

  const ctx=new (window.AudioContext||window.webkitAudioContext)();
  function sound(f,d){
    const o=ctx.createOscillator();
    const g=ctx.createGain();
    o.frequency.value=f;
    o.connect(g);g.connect(ctx.destination);
    o.start();
    g.gain.exponentialRampToValueAtTime(0.0001,ctx.currentTime+d);
    o.stop(ctx.currentTime+d);
  }

  function startGame(){
    name=document.getElementById("nameInput").value||"Friend";
    document.getElementById("nameScreen").style.display="none";
    document.getElementById("gameScreen").style.display="block";
    nextQ();
  }

  function nextQ(){
    answered=false;
    if(questionCount===TOTAL){ endGame(); return; }

    questionCount++;
    document.getElementById("qno").innerHTML=questionCount;
    document.getElementById("result").innerHTML="";

    const a=Math.floor(Math.random()*5)+1;
    const b=Math.floor(Math.random()*5)+1;
    correct=a+b;

    const f1=fruits[Math.floor(Math.random()*fruits.length)];
    const f2=fruits[Math.floor(Math.random()*fruits.length)];

    document.getElementById("question").innerHTML =
      `<div class="fruits">${f1.repeat(a)}</div><br>
       <div style="font-size:42px;">+</div><br>
       <div class="fruits">${f2.repeat(b)}</div>`;

    const ops=[correct,correct+1,correct-1].filter(n=>n>0).sort(()=>Math.random()-0.5);
    const optDiv=document.getElementById("options");
    optDiv.innerHTML="";
    ops.forEach(v=>{
      const btn=document.createElement("button");
      btn.textContent=v;
      btn.style.background="#00C853";
      btn.onclick=()=>check(v);
      optDiv.appendChild(btn);
    });
  }

  function check(v){
    if(answered)return;
    answered=true;

    document.querySelectorAll("#options button").forEach(b=>b.disabled=true);

    if(v===correct){
      score++; streak++;
      document.getElementById("result").textContent="Good job!";
      document.getElementById("question").classList.add("correct-anim");
      sound(800,0.25);

      if(streak===5){ document.getElementById("result").textContent="5 in a row! ‚≠ê"; }
      if(streak===10){ document.getElementById("result").textContent="10 in a row! üåü"; }

    } else {
      streak=0;
      document.getElementById("result").textContent="Try next time!";
      document.getElementById("question").classList.add("wrong-anim");
      sound(200,0.25);
    }

    setTimeout(()=>{
      document.getElementById("question").classList.remove("correct-anim","wrong-anim");
      nextQ();
    },1200);
  }

  function endGame(){
    document.getElementById("gameScreen").style.display="none";
    document.getElementById("endScreen").style.display="block";

    if(score===15) document.getElementById("endCelebration").textContent="Perfect! üéâ";
    else document.getElementById("endCelebration").textContent="Good!";

    document.getElementById("finalScore").textContent = `Hey ${name}, you scored ${score}/15`;

    saveBoard();
    showBoard();
  }

  function saveBoard(){
    let board=JSON.parse(localStorage.getItem("board"))||[];
    board.push({name,score});
    board.sort((a,b)=>b.score-a.score);
    board=board.slice(0,5);
    localStorage.setItem("board",JSON.stringify(board));
  }

  function showBoard(){
    let board=JSON.parse(localStorage.getItem("board"))||[];
    let h="";
    board.forEach((e,i)=>{
      h+=`<div class="leader">${i+1}. ${e.name} ‚Äî ${e.score}</div>`;
    });
    document.getElementById("leaderboard").innerHTML=h;
  }

  function shareResult(){
    const t=document.getElementById("endScreen");
    html2canvas(t).then(c=>{
      c.toBlob(b=>{
        const f=new File([b],"homework.png",{type:"image/png"});
        if(navigator.canShare&&navigator.canShare({files:[f]})){
          navigator.share({files:[f]});
        }
      });
    });
  }
</script>
</body>
</html>