<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Math Explorer â€“ Class 4</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
  background: linear-gradient(135deg,#fdfbfb,#ebedee);
  margin:0; padding:10px;
  text-align:center;
}

.card{
  background:#fff;
  max-width:420px;
  margin:auto;
  padding:16px;
  border-radius:16px;
  box-shadow:0 6px 14px rgba(0,0,0,.15);
}

h1{margin:6px;font-size:30px;}

button{
  font-size:18px;
  padding:10px 14px;
  margin:5px;
  border:none;
  border-radius:12px;
  background:#4a90e2;
  color:#fff;
}

button.secondary{background:#777;}
button.nav{background:#ffb300;color:#000;}
button.jump{font-size:15px;padding:6px 10px;margin:3px;}
button.selected{background:#2ecc71;}
button.whatsapp{background:#25D366;}

.options button{width:90%;}

.question{font-size:22px;margin:12px 0;}
.visual{font-size:44px;margin:8px;}

#jumpNav{margin-top:10px;}

.review-card{
  background:#fff;
  border-radius:12px;
  padding:12px;
  margin:10px auto;
  max-width:420px;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
  text-align:left;
}

.correct{color:#2ecc71;font-weight:bold;}
.wrong{color:#e74c3c;font-weight:bold;}

footer{font-size:14px;color:#666;margin-top:10px;}
</style>
</head>

<body>

<h1>ğŸ“˜ Math Explorer</h1>

<!-- NAME SCREEN -->
<div id="nameScreen" class="card">
  <p>Enter your name</p>
  <input id="nameInput" style="font-size:18px;padding:8px;width:85%;text-align:center;border-radius:10px;">
  <br><br>
  <button onclick="startGame()">Start</button>
</div>

<!-- GAME SCREEN -->
<div id="gameScreen" class="card" style="display:none;">
  <div id="progress"></div>
  <div id="questionArea"></div>
  <div class="options" id="options"></div>

  <div>
    <button class="nav" onclick="prevQ()">â¬… Prev</button>
    <button class="nav" onclick="nextQ()">Next â¡</button>
  </div>

  <div id="jumpNav"></div>
  <br>
  <button class="secondary" onclick="openReview()">Review Answers</button>
</div>

<!-- REVIEW BEFORE SUBMIT -->
<div id="reviewScreen" style="display:none;">
  <h2>ğŸ“ Review</h2>
  <div id="reviewArea"></div>
  <button class="secondary" onclick="backToGame()">â¬… Edit</button>
  <button onclick="submitFinal()">âœ… Submit</button>
</div>

<!-- RESULT SCREEN -->
<div id="resultScreen" class="card" style="display:none;">
  <h2>ğŸ‰ Result</h2>
  <p id="scoreText"></p>

  <button class="whatsapp" onclick="shareResult()">ğŸŸ¢ Share</button><br>
  <button onclick="openMistakeReview()">ğŸ” Review Mistakes</button><br>
  <button onclick="location.reload()">ğŸ”„ Replay</button>
</div>

<!-- REVIEW WITH ANSWERS -->
<div id="mistakeScreen" style="display:none;">
  <h2>ğŸ“˜ Learn from Mistakes</h2>
  <div id="mistakeArea"></div>
  <button onclick="location.reload()">Finish</button>
</div>

<footer>An MPPS Pedduru Initiative</footer>

<script>
/* ---------- Utilities ---------- */
function rand(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
function shuffle(arr){return arr.sort(()=>Math.random()-0.5);}

/* ---------- Question Generators ---------- */
function genAddition(){let a=rand(100,500),b=rand(10,200),ans=a+b;
 return {q:`${a} + ${b} = ?`,ans,opts:shuffle([ans,ans+10,ans-10]),vis:"â•"};}
function genSubtraction(){let a=rand(300,700),b=rand(50,250),ans=a-b;
 return {q:`${a} âˆ’ ${b} = ?`,ans,opts:shuffle([ans,ans+10,ans-10]),vis:"â–"};}
function genMultiplication(){let a=rand(4,9),b=rand(6,12),ans=a*b;
 return {q:`${a} Ã— ${b} = ?`,ans,opts:shuffle([ans,ans+4,ans-4]),vis:"âœ–ï¸"};}
function genDivision(){let b=rand(3,9),ans=rand(4,12),a=b*ans;
 return {q:`${a} Ã· ${b} = ?`,ans,opts:shuffle([ans,ans+1,ans-1]),vis:"â—"};}
function genApples(){let a=rand(3,7),b=rand(2,6),ans=a+b;
 return {q:`${a} apples + ${b} apples.<br>How many apples?`,ans,opts:shuffle([ans,ans+1,ans-1]),vis:"ğŸ"};}
function genCandies(){let kids=[2,3,4][rand(0,2)],ans=rand(3,8),total=kids*ans;
 return {q:`${total} candies shared by ${kids} children.<br>Each gets?`,ans,opts:shuffle([ans,ans+1,ans-1]),vis:"ğŸ¬"};}
function genBikes(){let bikes=rand(3,8),ans=bikes*2;
 return {q:`${bikes} bicycles have how many wheels?`,ans,opts:shuffle([ans,ans+2,ans-2]),vis:"ğŸš²"};}

/* ---------- Build Questions ---------- */
const generators=[genAddition,genSubtraction,genMultiplication,genDivision,genApples,genCandies,genBikes];
const TOTAL=15;
const questions=[];
for(let i=0;i<TOTAL;i++) questions.push(generators[rand(0,generators.length-1)]());

const answers=new Array(TOTAL).fill(null);
let current=0, name="", finalScore=0;

/* ---------- Game Logic ---------- */
function startGame(){
 name=document.getElementById("nameInput").value||"Student";
 nameScreen.style.display="none";
 gameScreen.style.display="block";
 buildJumpNav(); loadQ();
}

function loadQ(){
 progress.innerHTML=`Question ${current+1} of ${TOTAL}`;
 const q=questions[current];
 questionArea.innerHTML=`<div class="visual">${q.vis}</div><div class="question">${q.q}</div>`;
 options.innerHTML="";
 q.opts.forEach(v=>{
  const b=document.createElement("button");
  b.innerHTML=v;
  if(answers[current]===v) b.classList.add("selected");
  b.onclick=()=>{answers[current]=v;loadQ();};
  options.appendChild(b);
 });
 updateJumpNav();
}

function nextQ(){if(current<TOTAL-1){current++;loadQ();}}
function prevQ(){if(current>0){current--;loadQ();}}

function buildJumpNav(){
 jumpNav.innerHTML="";
 for(let i=0;i<TOTAL;i++){
  const b=document.createElement("button");
  b.className="jump"; b.innerText=i+1;
  b.onclick=()=>{current=i;loadQ();};
  jumpNav.appendChild(b);
 }
}
function updateJumpNav(){
 document.querySelectorAll(".jump").forEach((b,i)=>{
  b.style.background=answers[i]!=null?"#2ecc71":"#ccc";
  b.style.color="#000";
 });
}

/* ---------- Review & Submit ---------- */
function openReview(){
 gameScreen.style.display="none";
 reviewScreen.style.display="block";
 reviewArea.innerHTML=questions.map((q,i)=>`
  <div class="review-card">
   <b>Q${i+1}.</b> ${q.q}<br>
   Your answer: ${answers[i] ?? "Not answered"}
  </div>`).join("");
}

function backToGame(){reviewScreen.style.display="none";gameScreen.style.display="block";}

function submitFinal(){
 finalScore=0;
 questions.forEach((q,i)=>{if(answers[i]===q.ans) finalScore++;});
 reviewScreen.style.display="none";
 resultScreen.style.display="block";
 scoreText.innerHTML=`${name}, you scored <b>${finalScore}/${TOTAL}</b>`;
}

/* ---------- Mistake Review ---------- */
function openMistakeReview(){
 resultScreen.style.display="none";
 mistakeScreen.style.display="block";
 mistakeArea.innerHTML=questions.map((q,i)=>`
  <div class="review-card">
   <b>Q${i+1}.</b> ${q.q}<br>
   Your answer: <span class="${answers[i]===q.ans?'correct':'wrong'}">${answers[i] ?? "Not answered"}</span><br>
   Correct answer: <span class="correct">${q.ans}</span>
  </div>`).join("");
}

/* ---------- Share ---------- */
function shareResult(){
 html2canvas(resultScreen).then(c=>{
  c.toBlob(b=>{
   const f=new File([b],"result.png",{type:"image/png"});
   if(navigator.canShare&&navigator.canShare({files:[f]})){
    navigator.share({files:[f],title:"Math Result"});
   }
  });
 });
}
</script>

</body>
</html>